<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.1/css/bootstrap-slider.css">
    <link rel="stylesheet" href="styles.css">

    <title>Smoke Temp</title>
  </head>
  <body>
    <div class="jumbotron">
      <div class="textcoltop">
        <h1 class="display-4">Smoke Temp</h1>
      </div>
    </div>
    <div class=row>
      <div class="col-sm"></div>
      <div class="col-md" soft-sides>
        <h1>Temperature</h1>
        <input id="tempSlider" type="text" data-slider-min="150" data-slider-max="350" data-slider-step="5"/>
        <span>Current Temperature: <span id="tempSliderVal">150</span></span>
      </div>
      <div class="col-md" soft-sides>
        <button type="button" class="btn btn-primary" id="cooker">Start Cooking</button>
      </div>
      <div class="col-sm"></div>
    </div>
      <div class="col-sm"></div>
      <div class="col-md"></div>
        <div id="chartContainer" style="height: 300px; width: 100%;"></div>
      <div class="col-sm"></div>
    </div>

    <!-- All necessary JS libraries -->
    <script type=text/javascript>
      $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.1/bootstrap-slider.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>

  </body>
</html>
<script>
temper = 0;
$("#tempSlider").slider({
  formatter: function(value) {
      temper = value;
	    return 'Current value: ' + value;
     }
});
$("#tempSlider").on("slide", function(temper) {
    $("#tempSliderVal").text(temper.value);
  }
)
$("#cooker").on("click", function() {
    // Pull in JSON values frin wgatever I'm really writing to the file
  var dataPointsTarget = [];
  var dataPointsMeat = [];
  var dataPointsGrill = [];

  var options = {
  	theme: "light2",
  	title: {
  		text: "Temperature vs Time"
  	},
    axisX: {
      title: "Time",
      includeZero: false
    },
    axisY: {
      title: "Temperature (Fahrenheit)",
      includeZero: false
    },
  	data: [{
  		type: "line",
      name: "Target Temperature",
  		dataPoints: dataPointsTarget
  	},
    {
      type: "spline",
      name: "Meat Temperature",
      dataPoints: dataPointsMeat
    },
    {
      type: "spline",
      name: "Grill Temperature",
      dataPoints: dataPointsGrill
    }]
  };
  updateData();

  // Initial Values
  var xValue = 0;
  var yValue = temper;
  var newDataCount = 6;

  function updateData(data) {
  	if(newDataCount != 1) {
  		$.each(data, function(key, value) {
  			dataPointsTarget.push({x: xValue, y: temper});
        //dataPointsMeat.push({x: xValue, y: extract thermocouple value})
        //dataPointsGrill.push({x: xValue, y: extract thermocouple value})
  			xValue=xValue+3;
  		});
  	} else {
      dataPointsTarget.push({x: xValue, y: temper});
      //dataPointsMeat.push({x: xValue, y: extract thermocouple value})
      //dataPointsGrill.push({x: xValue, y: extract thermocouple value})
  		xValue=xValue+3;
  	}

  	newDataCount = 1;
  	$("#chartContainer").CanvasJSChart(options);
    if(xValue > 90) {
      dataPointsTarget.shift(); dataPointsMeat.shift(); dataPointsGrill.shift();
    }
  	setTimeout(updateData, 3000);
  }

});
</script>
